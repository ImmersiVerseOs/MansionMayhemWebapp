<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard ‚Äî Mansion Mayhem</title>
  <link rel="stylesheet" href="/css/candy.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .rank-row{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 1rem;background:var(--card);border:1px solid var(--border);border-radius:var(--r-sm);margin-bottom:0.5rem;transition:all 0.15s}
    .rank-row.top{border-color:rgba(255,184,0,0.15);box-shadow:var(--glow-gold)}
    .rank-n{width:32px;text-align:center;font-family:var(--font-display);font-weight:900;font-size:1rem;color:var(--text3)}
    .rank-row.top .rank-n{color:var(--gold)}
    .rank-name{flex:1;font-weight:600;font-size:0.9rem}
    .rank-val{font-family:var(--font-display);font-weight:800;font-size:1.1rem;color:var(--gold)}
  </style>
</head>
<body>
  <div class="page">
    <div class="orb3"></div>
    <div class="main"><div class="container-narrow">
      <h1 class="display-lg anim">üèÜ Leaderboard</h1>
      <div style="display:flex;gap:0.5rem;margin:1.25rem 0">
        <button class="pill pill-pink" style="cursor:pointer" onclick="filterBy('wins',this)">Most Wins</button>
        <button class="pill pill-ghost" style="cursor:pointer" onclick="filterBy('games',this)">Most Games</button>
      </div>
      <div id="list"><div class="spinner" style="margin:3rem auto"></div></div>
    </div></div>
  </div>
  <script type="module">
    import{waitForSupabase}from'/js/supabase.js';
    import{initSidebar}from'/js/sidebar.js';
    import*as userMod from'/js/supabase.js';
    let sb,fil='wins';
    async function init(){sb=await waitForSupabase();await initSidebar('leaderboard',userMod);load()}
    async function load(){const col=fil==='wins'?'games_won':'games_played';const{data}=await sb.from('profiles').select('id,display_name,games_played,games_won').gt(col,0).order(col,{ascending:false}).limit(50);const el=document.getElementById('list');if(!data?.length){el.innerHTML='<div class="empty"><div class="empty-icon">üèÜ</div>No players yet.</div>';return}const medals=['üëë','ü•à','ü•â'];el.innerHTML=data.map((p,i)=>`<div class="rank-row ${i<3?'top':''} anim" style="animation-delay:${Math.min(i*0.03,0.3)}s"><div class="rank-n">${i<3?medals[i]:i+1}</div><div class="av av-sm ${i<3?'av-gold':''}">${p.display_name?p.display_name[0].toUpperCase():'?'}</div><div class="rank-name">${p.display_name||'Player'}</div><div><div class="rank-val">${fil==='wins'?p.games_won:p.games_played}</div><div style="font-size:0.65rem;color:var(--text3);text-align:right">${fil==='wins'?'wins':'games'}</div></div></div>`).join('')}
    window.filterBy=(f,el)=>{fil=f;document.querySelectorAll('.pill').forEach(p=>{p.className=`pill ${p.textContent.toLowerCase().includes(f)?'pill-pink':'pill-ghost'}`;p.style.cursor='pointer'});load()};
    init();
  </script>
</body>
</html>
