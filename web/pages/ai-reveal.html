<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Big Reveal | Mansion Mayhem</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
    }

    .bg-overlay {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 50% 50%, rgba(156, 39, 176, 0.15) 0%, transparent 60%),
        linear-gradient(180deg, #000 0%, #0a0612 50%, #000 100%);
      z-index: -1;
    }

    .header {
      text-align: center;
      padding: 3rem 2rem 2rem;
    }

    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }

    .episode-tag {
      font-size: 0.875rem;
      font-weight: 700;
      letter-spacing: 3px;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem 4rem;
    }

    .reveal-hero {
      text-align: center;
      margin-bottom: 4rem;
    }

    .reveal-badge {
      display: inline-block;
      background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      font-weight: 700;
      font-size: 0.875rem;
      letter-spacing: 1px;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(156, 39, 176, 0.4);
    }

    .reveal-title {
      font-family: 'Playfair Display', serif;
      font-size: 3.5rem;
      font-weight: 900;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #9c27b0 0%, #d4af37 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .reveal-subtitle {
      font-size: 1.25rem;
      color: rgba(255, 255, 255, 0.6);
      max-width: 700px;
      margin: 0 auto 2rem;
      line-height: 1.6;
    }

    .stats-box {
      display: flex;
      justify-content: center;
      gap: 4rem;
      margin-bottom: 4rem;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-family: 'Playfair Display', serif;
      font-size: 4rem;
      font-weight: 900;
      margin-bottom: 0.5rem;
    }

    .stat.human .stat-value {
      color: #10b981;
    }

    .stat.ai .stat-value {
      color: #9c27b0;
    }

    .stat-label {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255, 255, 255, 0.6);
    }

    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      font-weight: 900;
      margin-bottom: 2rem;
      text-align: center;
    }

    .cast-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 4rem;
    }

    .cast-card {
      background: linear-gradient(135deg, rgba(20, 16, 32, 0.6) 0%, rgba(10, 6, 18, 0.8) 100%);
      border: 3px solid;
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: all 0.4s;
    }

    .cast-card.human {
      border-color: rgba(16, 185, 129, 0.4);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
    }

    .cast-card.ai {
      border-color: rgba(156, 39, 176, 0.4);
      background: linear-gradient(135deg, rgba(156, 39, 176, 0.1) 0%, rgba(123, 31, 162, 0.05) 100%);
    }

    .cast-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 60px rgba(156, 39, 176, 0.3);
    }

    .cast-card.human:hover {
      box-shadow: 0 20px 60px rgba(16, 185, 129, 0.3);
    }

    .type-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .cast-card.human .type-badge {
      background: #10b981;
      color: #fff;
    }

    .cast-card.ai .type-badge {
      background: #9c27b0;
      color: #fff;
    }

    .cast-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      margin: 0 auto 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      font-weight: 900;
      border: 4px solid;
    }

    .cast-card.human .cast-avatar {
      background: linear-gradient(135deg, #10b981, #059669);
      border-color: rgba(16, 185, 129, 0.4);
      box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4);
    }

    .cast-card.ai .cast-avatar {
      background: linear-gradient(135deg, #9c27b0, #7b1fa2);
      border-color: rgba(156, 39, 176, 0.4);
      box-shadow: 0 8px 32px rgba(156, 39, 176, 0.4);
    }

    .cast-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .cast-archetype {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1.5rem;
    }

    .cast-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .mini-stat {
      text-align: center;
    }

    .mini-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .cast-card.human .mini-stat-value {
      color: #10b981;
    }

    .cast-card.ai .mini-stat-value {
      color: #9c27b0;
    }

    .mini-stat-label {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .surprise-box {
      background: linear-gradient(135deg, rgba(156, 39, 176, 0.15) 0%, rgba(123, 31, 162, 0.1) 100%);
      border: 2px solid rgba(156, 39, 176, 0.3);
      border-radius: 20px;
      padding: 3rem;
      text-align: center;
      margin-bottom: 3rem;
    }

    .surprise-title {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 1rem;
      color: #9c27b0;
    }

    .surprise-text {
      font-size: 1.125rem;
      color: rgba(255, 255, 255, 0.7);
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.8;
    }

    .loading {
      text-align: center;
      padding: 4rem 2rem;
      font-size: 1.125rem;
      color: rgba(255, 255, 255, 0.6);
    }

    @media (max-width: 768px) {
      .logo { font-size: 2rem; }
      .reveal-title { font-size: 2.5rem; }
      .stats-box { flex-direction: column; gap: 2rem; }
      .cast-grid { grid-template-columns: 1fr; }
    }
  </style>
  <link rel="stylesheet" href="css/modern-theme.css">
</head>
<body>
  <div class="bg-overlay"></div>

  <div class="header">
    <div class="logo">MANSION MAYHEM</div>
    <div class="episode-tag">The Big Reveal</div>
  </div>

  <div class="container">
    <div class="reveal-hero">
      <div class="reveal-badge">ðŸŽ­ REVEALED</div>
      <div class="reveal-title">Who Was Real?</div>
      <div class="reveal-subtitle">
        You've been playing alongside AI-powered houseguests designed to create drama, form alliances, and compete like real players.
        Can you guess who was who?
      </div>
    </div>

    <div id="content" class="loading">
      Loading the big reveal...
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const sb = window.supabase.createClient(
      'https://fpxbhqibimekjhlumnmc.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZweGJocWliaW1la2pobHVtbm1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMjUwODYsImV4cCI6MjA4NjYwMTA4Nn0.0BmbaObOERMZ5r4znb5BQbrGpB5lE5Fq6KnEzxA0YhY'
    )

    async function loadReveal() {
      const content = document.getElementById('content')

      try {
        // Get completed game (most recent)
        const { data: game } = await sb
          .from('mm_games')
          .select('*')
          .eq('status', 'completed')
          .order('completed_at', { ascending: false })
          .limit(1)
          .single()

        if (!game) {
          content.innerHTML = '<div class="error">No completed game found. The reveal will happen after the game ends!</div>'
          return
        }

        // Get all cast members from the game
        const { data: cast } = await sb
          .from('mm_game_cast')
          .select(`
            *,
            cast_members!inner(id, display_name, archetype, is_ai_player, ai_personality_config)
          `)
          .eq('game_id', game.id)

        if (!cast) {
          content.innerHTML = '<div class="error">No cast members found</div>'
          return
        }

        const humans = cast.filter(c => !c.cast_members.is_ai_player)
        const ais = cast.filter(c => c.cast_members.is_ai_player)

        content.innerHTML = `
          <div class="stats-box">
            <div class="stat human">
              <div class="stat-value">${humans.length}</div>
              <div class="stat-label">Human Players</div>
            </div>
            <div class="stat ai">
              <div class="stat-value">${ais.length}</div>
              <div class="stat-label">AI Characters</div>
            </div>
          </div>

          <div class="surprise-box">
            <div class="surprise-title">Did You Guess Right?</div>
            <div class="surprise-text">
              Our AI characters were powered by advanced language models trained to behave like real reality TV contestants.
              They formed genuine alliances, created drama, and competed strategically. Some players never suspected a thing!
            </div>
          </div>

          <div class="section-title" style="color: #10b981;">Human Players</div>
          <div class="cast-grid">
            ${humans.map(h => `
              <div class="cast-card human">
                <div class="type-badge">Human</div>
                <div class="cast-avatar">${h.cast_members.display_name[0]}</div>
                <div class="cast-name">${h.cast_members.display_name}</div>
                <div class="cast-archetype">${h.cast_members.archetype}</div>
                <div class="cast-stats">
                  <div class="mini-stat">
                    <div class="mini-stat-value">${h.placement || '-'}</div>
                    <div class="mini-stat-label">Place</div>
                  </div>
                  <div class="mini-stat">
                    <div class="mini-stat-value">Real</div>
                    <div class="mini-stat-label">Player</div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>

          <div class="section-title" style="color: #9c27b0; margin-top: 3rem;">AI Characters</div>
          <div class="cast-grid">
            ${ais.map(a => {
              const personality = a.cast_members.ai_personality_config
              const style = personality?.communication_style || 'Unknown'

              return `
                <div class="cast-card ai">
                  <div class="type-badge">AI</div>
                  <div class="cast-avatar">${a.cast_members.display_name[0]}</div>
                  <div class="cast-name">${a.cast_members.display_name}</div>
                  <div class="cast-archetype">${a.cast_members.archetype}</div>
                  <div style="font-size: 0.875rem; color: rgba(255,255,255,0.6); margin: 1rem 0;">
                    Communication: ${style}
                  </div>
                  <div class="cast-stats">
                    <div class="mini-stat">
                      <div class="mini-stat-value">${a.placement || '-'}</div>
                      <div class="mini-stat-label">Place</div>
                    </div>
                    <div class="mini-stat">
                      <div class="mini-stat-value">AI</div>
                      <div class="mini-stat-label">Powered</div>
                    </div>
                  </div>
                </div>
              `
            }).join('')}
          </div>

          <div class="surprise-box">
            <div class="surprise-title">The Future of Interactive Entertainment</div>
            <div class="surprise-text">
              Mansion Mayhem proves AI can create truly immersive, dynamic social experiences.
              Every game is different because our AI characters adapt, strategize, and evolve based on human interactions.
              Welcome to the future of reality TV.
            </div>
          </div>
        `
      } catch (err) {
        console.error(err)
        content.innerHTML = `<div class="error">Error loading reveal: ${err.message}</div>`
      }
    }

    loadReveal()
  </script>
</body>
</html>
